(()=>{var e={};e.id=688,e.ids=[688],e.modules={361:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},714:(e,t,r)=>{"use strict";function s(e){return{id:Date.now(),created_at:new Date().toISOString(),updated_at:new Date().toISOString(),child_conversations:[],num_of_children:0,role:"assistant",conversation_id:0,content:"",reasoning_summary:"",...e}}r.d(t,{Y:()=>s})},802:e=>{"use strict";e.exports=import("clsx")},943:e=>{"use strict";e.exports=require("lodash/isEmpty")},1283:e=>{"use strict";e.exports=import("remark-math")},2015:e=>{"use strict";e.exports=require("react")},2326:e=>{"use strict";e.exports=require("react-dom")},2759:e=>{"use strict";e.exports=import("remark-gfm")},3472:e=>{"use strict";e.exports=import("@heroui/drawer")},3584:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.d(t,{A:()=>b});var a=r(8732),i=r(2015),n=r(7689),l=r(7981),o=r(5167),c=r(1283),u=r(2759);r(7586);var d=r(6843),m=r(6306),p=r(6152),h=r(4688),x=r(4647),f=r(9320),g=r(5809),y=r(1659),v=e([l,o,c,u,p,f,g]);[l,o,c,u,p,f,g]=v.then?(await v)():v;let w={show:!1,x:0,y:0,text:""},b=({message:e,selectedMessagesIds:t,startNewQuote:r,resetInput:s,isThinking:v=!1})=>{let b=(0,n.useRouter)(),[S,j]=(0,i.useState)(w),{id:_,focus:N}=b.query||{},C=Number(N)===e.id,k=t.has(e.id),M=(0,i.useCallback)(e=>{},[]),L=(0,i.useCallback)(e=>{e.stopPropagation()},[]);(0,i.useEffect)(()=>{let t=t=>{if(S.show){let r=document.getElementById(e?.id?`msg-${e.id}`:"");r&&!r.contains(t.target)&&j(w)}};return S.show&&document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[S.show,e?.id]);let P=(0,i.useMemo)(()=>(0,a.jsx)(l.default,{components:{code(e){let{children:t,className:r,...s}=e,i=/language-(\w+)/.exec(r||"");return i?(0,a.jsx)(d.Prism,{PreTag:"div",customStyle:{width:"100%",borderRadius:"8px"},language:i[1],style:m.vscDarkPlus,children:String(t).replace(/\n$/,"")}):(0,a.jsx)("code",{...s,className:r,children:t})}},rehypePlugins:[o.default],remarkPlugins:[c.default,u.default],children:e.content}),[e.content]),E=(0,i.useMemo)(()=>(0,a.jsx)(l.default,{components:{code(e){let{children:t,className:r,...s}=e,i=/language-(\w+)/.exec(r||"");return i?(0,a.jsx)(d.Prism,{PreTag:"div",customStyle:{width:"100%",borderRadius:"8px"},language:i[1],style:m.vscDarkPlus,children:String(t).replace(/\n$/,"")}):(0,a.jsx)("code",{...s,className:r,children:t})}},rehypePlugins:[o.default],remarkPlugins:[c.default,u.default],children:e.reasoning_summary}),[e.reasoning_summary]);return(0,a.jsxs)("div",{className:"relative flex min-w-full flex-col",id:e?.id?`msg-${e.id}`:void 0,onMouseUp:M,children:[e.reasoning_summary?(0,a.jsx)(g.Accordion,{className:"flex min-w-full",children:(0,a.jsx)(g.AccordionItem,{"aria-label":v?"Thinking":"Thoughts",className:"prose dark:prose-invert text-sm min-w-full",classNames:{heading:`cursor-pointer mb-0 ${v?"animate-pulse":""}`,trigger:"pb-0",content:"dark:text-[#f3f3f3] text-gray-700 py-0"},title:v?"Thinking":"Thoughts",children:(0,a.jsx)("div",{onMouseUp:L,children:E})})}):null,S.show?(0,a.jsx)("div",{className:"absolute z-50",style:{left:S.x,top:S.y},children:(0,a.jsxs)("button",{className:"shadow-md flex items-center justify-center gap-1.5 px-2.5 py-1.5 text-base rounded-full bg-gray-100 dark:bg-[#212121] border-1 border-default-200 dark:border-default-300 font-medium cursor-pointer",onClick:()=>r(e,y.wf.REPLY,S.text),children:[(0,a.jsx)(x.aBh,{className:"w-4.5 h-4.5"}),"Ask Chatbot"]})}):null,(0,a.jsxs)("div",{className:"min-h-8 relative flex w-full flex-col items-start text-start break-words whitespace-normal",role:"group",children:[(0,a.jsx)("div",{className:`prose dark:prose-invert relative max-w-full p-2 ${C?"border-2 border-amber-500":""}`,children:P}),e.content?(0,a.jsxs)("div",{className:"flex flex-row gap-1 text-xs text-gray-500 dark:text-gray-200 px-2",children:[(0,a.jsxs)("button",{className:"flex items-center gap-1 cursor-pointer hover:opacity-70 transition-all duration-200 bg-gray-100 dark:bg-[#323232D9] px-1 py-0.5 rounded-sm font-medium",type:"button",onClick:()=>r(e,y.wf.NEW_THREAD),children:[(0,a.jsx)(h.BlJ,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"New thread"})]}),e.child_conversations&&e.child_conversations.length>0?(0,a.jsxs)(p.Dropdown,{className:"max-w-[300px]",children:[(0,a.jsx)(p.DropdownTrigger,{children:(0,a.jsxs)("button",{className:"flex items-center gap-1 cursor-pointer hover:opacity-70 transition-all duration-200 font-normal bg-gray-100 dark:bg-[#323232D9] px-1 py-0.5 rounded-sm",type:"button",children:[(0,a.jsx)(x.y6Z,{className:"w-4 h-4"}),"Threads"]})}),(0,a.jsx)(p.DropdownMenu,{children:(e.child_conversations||[]).map(e=>(0,a.jsx)(p.DropdownItem,{onClick:()=>{b.push(`/chat/${e.id}`),s()},children:e.name},e.id))})]}):null,(0,a.jsxs)("button",{className:"flex items-center cursor-pointer hover:opacity-70 transition-all duration-200 bg-gray-100 dark:bg-[#323232D9] px-1 py-0.5 rounded-sm font-medium",type:"button",onClick:()=>r(e,y.wf.SELECT),children:[(0,a.jsx)(f.Checkbox,{isSelected:k,radius:"sm",size:"sm",onValueChange:()=>r(e,y.wf.SELECT)}),(0,a.jsx)("span",{children:k?"Selected message":"Select message"})]}),C?(0,a.jsx)("button",{className:"flex items-center cursor-pointer hover:opacity-70 transition-all duration-200 bg-gray-100 dark:bg-[#323232D9] px-1 py-0.5 rounded-sm font-medium",type:"button",onClick:()=>{b.replace(`/chat/${_}`)},children:"Stop focus"}):null]}):null]})]})};s()}catch(e){s(e)}})},3873:e=>{"use strict";e.exports=require("path")},4075:e=>{"use strict";e.exports=require("zlib")},4647:(e,t,r)=>{"use strict";r.d(t,{aBh:()=>i,y6Z:()=>a});var s=r(1251);function a(e){return(0,s.k5)({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M2 22L7.29117 20.8242C8.6944 21.5746 10.2975 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 13.7025 2.42544 15.3056 3.17581 16.7088L2 22ZM8.23428 19.0605L7.58075 18.711L4.63416 19.3658L5.28896 16.4192L4.93949 15.7657C4.32549 14.6175 4 13.3345 4 12C4 7.58172 7.58172 4 12 4C16.4183 4 20 7.58172 20 12C20 16.4183 16.4183 20 12 20C10.6655 20 9.38248 19.6745 8.23428 19.0605ZM15.4487 7H13.4411L13.2661 9.00024H11.2584L11.4334 7H9.42577L9.25077 9.00024H7V11.0002H9.0758L8.90082 13.0002H7V15.0002H8.72584L8.55089 17H10.5585L10.7335 15.0002H12.7411L12.5662 17H14.5738L14.7488 15.0002H17V13.0002H14.9237L15.0987 11.0002H17V9.00024H15.2737L15.4487 7ZM11.0834 11.0002H13.0911L12.9161 13.0002H10.9085L11.0834 11.0002Z"},child:[]}]})(e)}function i(e){return(0,s.k5)({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M19.4167 6.67891C20.4469 7.77257 21.0001 9 21.0001 10.9897C21.0001 14.4891 18.5436 17.6263 14.9695 19.1768L14.0768 17.7992C17.4121 15.9946 18.0639 13.6539 18.3245 12.178C17.7875 12.4557 17.0845 12.5533 16.3954 12.4895C14.591 12.3222 13.1689 10.8409 13.1689 9C13.1689 7.067 14.7359 5.5 16.6689 5.5C17.742 5.5 18.7681 5.99045 19.4167 6.67891ZM9.41669 6.67891C10.4469 7.77257 11.0001 9 11.0001 10.9897C11.0001 14.4891 8.54359 17.6263 4.96951 19.1768L4.07682 17.7992C7.41206 15.9946 8.06392 13.6539 8.32447 12.178C7.78747 12.4557 7.08452 12.5533 6.39539 12.4895C4.59102 12.3222 3.16895 10.8409 3.16895 9C3.16895 7.067 4.73595 5.5 6.66895 5.5C7.742 5.5 8.76814 5.99045 9.41669 6.67891Z"},child:[]}]})(e)}},5167:e=>{"use strict";e.exports=import("rehype-katex")},5809:e=>{"use strict";e.exports=import("@heroui/accordion")},5949:e=>{"use strict";e.exports=import("@heroui/spinner")},6152:e=>{"use strict";e.exports=import("@heroui/dropdown")},6189:e=>{"use strict";e.exports=import("@heroui/breadcrumbs")},6306:e=>{"use strict";e.exports=require("react-syntax-highlighter/dist/cjs/styles/prism")},6689:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{config:()=>x,default:()=>d,getServerSideProps:()=>h,getStaticPaths:()=>p,getStaticProps:()=>m,reportWebVitals:()=>f,routeModule:()=>S,unstable_getServerProps:()=>w,unstable_getServerSideProps:()=>b,unstable_getStaticParams:()=>v,unstable_getStaticPaths:()=>y,unstable_getStaticProps:()=>g});var a=r(3325),i=r(1005),n=r(181),l=r(2314),o=r(8594),c=r(9758),u=e([l,o,c]);[l,o,c]=u.then?(await u)():u;let d=(0,n.M)(c,"default"),m=(0,n.M)(c,"getStaticProps"),p=(0,n.M)(c,"getStaticPaths"),h=(0,n.M)(c,"getServerSideProps"),x=(0,n.M)(c,"config"),f=(0,n.M)(c,"reportWebVitals"),g=(0,n.M)(c,"unstable_getStaticProps"),y=(0,n.M)(c,"unstable_getStaticPaths"),v=(0,n.M)(c,"unstable_getStaticParams"),w=(0,n.M)(c,"unstable_getServerProps"),b=(0,n.M)(c,"unstable_getServerSideProps"),S=new a.PagesRouteModule({definition:{kind:i.A.PAGES,page:"/chat/[id]",pathname:"/chat/[id]",bundlePath:"",filename:""},components:{App:o.default,Document:l.default},userland:c});s()}catch(e){s(e)}})},6843:e=>{"use strict";e.exports=require("react-syntax-highlighter")},7280:e=>{"use strict";e.exports=import("@heroui/system")},7312:e=>{"use strict";e.exports=import("next-themes")},7586:()=>{},7910:e=>{"use strict";e.exports=require("stream")},7981:e=>{"use strict";e.exports=import("react-markdown")},8732:e=>{"use strict";e.exports=require("react/jsx-runtime")},9021:e=>{"use strict";e.exports=require("fs")},9320:e=>{"use strict";e.exports=import("@heroui/checkbox")},9361:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.d(t,{A:()=>g});var a=r(8732),i=r(2015),n=r(7689),l=r(5949),o=r(4493),c=r(3850),u=r(3584),d=r(9388),m=r(1838),p=r(1659),h=r(3046),x=r(714),f=e([l,c,u]);[l,c,u]=f.then?(await f)():f;let g=({historyMessages:e=[]})=>{let t=(0,n.useRouter)(),{id:r,focus:s,agentic_mode:f}=t.query||{},g=(0,i.useRef)(null),y=(0,i.useRef)(!1),v=(0,i.useRef)(null),w=(0,i.useRef)(void 0),[b,S]=(0,i.useState)([]),[j,_]=(0,i.useState)(""),[N,C]=(0,i.useState)(""),[k,M]=(0,i.useState)(!1),[L,P]=(0,i.useState)(),[E,H]=(0,i.useState)(void 0),[T,q]=(0,i.useState)(void 0),[A,D]=(0,i.useState)(new Set([])),[R,$]=(0,i.useState)(0),I=(0,i.useMemo)(()=>[...e,...b],[e,b]),z=Math.ceil((R||0)+(g.current?.clientHeight||0)+20)>=(g.current?.scrollHeight||0),V=(e="smooth")=>{let t=g.current;t?.scrollTo({top:t.scrollHeight,behavior:e})},Z=async(e,t=!1,s,a={},i={})=>{if(!e.trim())return;M(!0),t||S([...b,(0,x.Y)({conversation_id:Number(r),content:e,role:"user",...a})]);let n="",l="";try{let a=await (0,m.t5)({conversationId:Number(r),userMsg:e.trim(),isNewConversation:t,agenticMode:s,promptMode:E,extraParams:i});if(!a.body)throw Error("ReadableStream not supported in this environment.");v.current=a.body.getReader();let o=new TextDecoder,c=!1;for(;!c;){let{value:e,done:t}=await v.current.read();if(e){let t=o.decode(e,{stream:!0}).split("\n"),r="",s="";for(let e of t)if(e.trim()){let t=JSON.parse(e);"real_content"===t.type?r+=t.content:"reasoning_summary"===t.type&&(s+=t.content),w.current=Number(t.message_id)}n+=r,l+=s,_(n+(n?"|":"")),C(l+(l&&!n?"|":""))}c=t}}catch(e){e instanceof Error&&"AbortError"===e.name?console.log("Stream was cancelled"):console.error("Stream error:",e)}finally{v.current?.releaseLock(),v.current=null,M(!1),S(e=>[...e,(0,x.Y)({id:w.current,content:n,role:"assistant",conversation_id:Number(r),reasoning_summary:l})]),_(""),C("")}},B=async()=>{1!==e.length||"user"!==e[0].role||y.current||(y.current=!0,Z(e[0].content,!0,f))};(0,i.useLayoutEffect)(()=>{g.current&&(g.current.style.visibility="hidden")},[r]),(0,i.useLayoutEffect)(()=>{S([])},[r,f,s]),(0,i.useEffect)(()=>{B(),V("instant"),g.current&&(g.current.style.visibility="visible")},[r]),(0,i.useEffect)(()=>{!L&&k&&V()},[b,k]),(0,i.useEffect)(()=>()=>{v.current&&v.current.cancel()},[]),(0,i.useEffect)(()=>{setTimeout(()=>{(0,h.U)(s)},100)},[r,s]);let Y=async(e,t)=>{Z(e,!1,t)},Q=async(e,r)=>{try{M(!0);let s=await (0,m.cK)(e,L?.id),a=r?`?agentic_mode=${r}`:"";t.push(`/chat/${s.id}${a}`),P(void 0),S([]),y.current=!1}finally{M(!1)}},U=async(e,t)=>{Z(e,!1,t,{referred_message_id:L?.id,referred_message_content:T},{referred_message:L,sub_str:T??""})},W=()=>{P(void 0)},O=async(e,t)=>{let r=I.filter(e=>A.has(e.id)).map(e=>({content:e.content,role:e.role}));Z(e,!1,t,void 0,{selected_messages:r})},G=(e,t,r)=>{if(P(e),H(t),t!==p.wf.SELECT&&D(new Set([])),t===p.wf.REPLY)q(r);else if(t===p.wf.SELECT){let t=new Set(A);t.has(e.id)?t.delete(e.id):t.add(e.id),t.size<=0&&J(),D(t)}},J=()=>{P(void 0),H(void 0),q(void 0),D(new Set([]))};return(0,a.jsxs)("div",{className:"dark:bg-[#212121e6] relative flex h-full max-w-full flex-1 flex-col gap-3 px-2 py-4 overflow-hidden shrink-0",children:[(0,a.jsx)("div",{ref:g,className:"relative flex flex-col h-full w-full overflow-y-auto mb-10",style:{visibility:"hidden"},onScroll:()=>{$(g.current?.scrollTop||0)},children:(0,a.jsxs)("div",{className:"relative flex flex-col gap-10 h-full max-w-200 w-full mx-auto",children:[I.map(e=>"user"===e.role?(0,a.jsx)(d.A,{message:e},e.id):(0,a.jsx)(u.A,{message:e,resetInput:W,selectedMessagesIds:A,startNewQuote:G},e.id)),k?(0,a.jsxs)("div",{className:"flex flex-col min-w-full",children:[(0,a.jsx)(u.A,{isThinking:k&&!j,message:(0,x.Y)({id:w.current,content:j,reasoning_summary:N,conversation_id:Number(r),role:"assistant"}),resetInput:W,selectedMessagesIds:A,startNewQuote:G}),j||N?null:(0,a.jsx)(l.Spinner,{className:"self-start",color:"current",size:"md",variant:"dots"})]}):null,(0,a.jsx)("div",{className:"invisible min-h-50",style:k?{minHeight:"calc(100svh - 75px - 225px"}:{},children:"placeholder"})]})}),(0,a.jsxs)("div",{className:"absolute inset-x-0 bottom-5 z-10 flex flex-col gap-2 items-center justify-center w-full px-2",children:[(0,a.jsx)("button",{className:"bg-white dark:bg-[#212121e6] border-1 border-gray-300 dark:border-gray-600 flex items-center justify-center h-9 w-9 min-w-9 min-h-9 rounded-full cursor-pointer p-0 transition-[opacity] duration-200",style:{opacity:z?"0":"100"},type:"button",onClick:()=>V(),children:(0,a.jsx)(o.Erz,{className:"w-[20px] h-[20px]"})}),(0,a.jsx)("div",{className:"w-full px-2 max-w-200",children:(0,a.jsx)(c.A,{customClassName:"w-full",handleStop:()=>{v.current&&(v.current.cancel(),v.current=null),M(!1),_(""),C("")},handleSubmit:(e,t)=>{E===p.wf.NEW_THREAD?Q(e,t):E===p.wf.REPLY?(J(),U(e,t)):E===p.wf.SELECT?(J(),O(e,t)):Y(e,t)},isSubmitting:k,quoteMsg:L,quoteType:E,replySubstr:T,selectedMessageIds:A,onCloseQuote:J})})]})]})};s()}catch(e){s(e)}})},9388:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var s=r(8732),a=r(7689),i=r(2015),n=r.n(i),l=r(1251);function o(e){return(0,l.k5)({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M6.598 5.013a.144.144 0 0 1 .202.134V6.3a.5.5 0 0 0 .5.5c.667 0 2.013.005 3.3.822.984.624 1.99 1.76 2.595 3.876-1.02-.983-2.185-1.516-3.205-1.799a8.7 8.7 0 0 0-1.921-.306 7 7 0 0 0-.798.008h-.013l-.005.001h-.001L7.3 9.9l-.05-.498a.5.5 0 0 0-.45.498v1.153c0 .108-.11.176-.202.134L2.614 8.254l-.042-.028a.147.147 0 0 1 0-.252l.042-.028zM7.8 10.386q.103 0 .223.006c.434.02 1.034.086 1.7.271 1.326.368 2.896 1.202 3.94 3.08a.5.5 0 0 0 .933-.305c-.464-3.71-1.886-5.662-3.46-6.66-1.245-.79-2.527-.942-3.336-.971v-.66a1.144 1.144 0 0 0-1.767-.96l-3.994 2.94a1.147 1.147 0 0 0 0 1.946l3.994 2.94a1.144 1.144 0 0 0 1.767-.96z"},child:[]}]})(e)}var c=r(3046);let u=n().memo(({message:e})=>{let t=(0,a.useRouter)(),r=async()=>{await t.replace({pathname:t.pathname,query:{...t.query,focus:e.referred_message_id}}),e.referred_message_id&&(0,c.U)(e.referred_message_id)};return(0,s.jsxs)("div",{className:"relative flex max-w-full flex-col gap-1 px-2",id:e?.id?`msg-${e.id}`:void 0,children:[e.referred_message_content?(0,s.jsxs)("button",{className:"text-sm text-gray-500 dark:text-gray-400 flex items-start text-right justify-end gap-1 cursor-pointer",type:"button",onClick:r,children:[e.referred_message_content,(0,s.jsx)(o,{className:"w-4.5 h-4.5"})]}):null,(0,s.jsx)("div",{className:"min-h-8 relative flex w-full flex-col items-end gap-2 text-start break-words whitespace-normal",children:(0,s.jsx)("div",{className:"relative max-w-3/4 rounded-[18px] bg-gray-200 dark:bg-[#ffffff1a] p-2",children:(0,s.jsx)("div",{className:"whitespace-pre-wrap",children:e.content})})})]})})},9758:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{default:()=>u,getServerSideProps:()=>d});var a=r(8732),i=r(9361),n=r(795),l=r(6540),o=r(1838),c=e([i,n]);[i,n]=c.then?(await c)():c;let d=async({params:e})=>{let[t,r]=await Promise.all([(0,o.uT)(),(0,o.QG)(Number(e?.id))]);return{props:{conversations:t,history:r}}};function u({conversations:e,history:t}){return(0,a.jsx)(l.A,{conversations:e,children:(0,a.jsxs)("div",{className:"relative flex max-w-full h-full flex-1 flex-col",children:[(0,a.jsx)(n.A,{conversations:e,historyMessages:t.messages,path:t.path}),(0,a.jsx)(i.A,{historyMessages:t.messages})]})})}s()}catch(e){s(e)}})}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[931,937,453,167,200],()=>r(6689));module.exports=s})();